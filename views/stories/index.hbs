<h1>Stories</h1>
<ul class="search-form">
    <li>
        <form id="search-site"  action='/stories/search/' method='get'>
            <div class="input-group">
                    <i class="fas fa-search fa-large" ></i>
                    <div class="input-field">
                    <input id="search" type="search" name='query' placeholder="Search by title">
                    <label class="label-icon" for="search">
                    </label>
                 </div>
                <button type="submit" class="input-group-addon btn">search</button>
            </div>

        </form>
    </li>
</ul>
<div class="row">
  {{#each stories}}
  <div class="col s12 m4">
    <div class="card">
      {{#if user._id}}
        <div class="card-image">
          {{{editIcon user ../user _id}}}
        </div>
      {{else}}
        <div class="card-image">
          {{{editIcon localuser ../localuser _id}}}
        </div>
      {{/if}}

            <div class="card-content center-align">
                <h5>{{title}}</h5>
                <p>{{stripTags (truncate body 150)}}</p>
                <br>
                {{#if user._id}}

                <div class="chip">
                    <img src="{{getImageUrl user.image.data}}" alt="">
                    <a href="/stories/user/{{user._id}}">{{user.displayName}}</a>
                </div>
                {{else}}
                <div class="chip">

                  <img src="{{getImageUrl localuser.image.data}}" alt="">
                    <a href="/stories/user/{{localuser._id}}">{{localuser.firstName}} {{localuser.lastName}}</a>
                </div>
                {{/if}}

            </div>
            <div class="card-action center-align">
                <a href="/stories/{{_id}}" class="btn grey">Read More</a>
            </div>
        </div>
    </div>
    {{else}}
    <p>No stories to display</p>
    {{/each}}
</div>
<script>
    document.getElementById('search-site').addEventListener('submit', function(e) {
        e.preventDefault(); // Prevents the form from submitting normally

        // Get the value from the input field
        var queryValue = document.getElementById('search').value;

        // Update the action attribute with the actual query
        if(queryValue!=''){
          this.action = '/stories/search/' + encodeURIComponent(queryValue);

          // Submit the form
          this.submit();

        }

    });
</script>
